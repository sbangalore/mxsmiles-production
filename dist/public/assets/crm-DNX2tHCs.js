import{R as e,r as s,j as a,c as t,T as i,d as l,e as r,f as c,h as n,M as d,i as x,k as o,D as m,l as h,P as j,m as u,C as p}from"./react-core-P3WkkLqe.js";import{L as g}from"./router-QwF-8Sgd.js";import{c as f,d as N,C as v,e as y,f as b,g as w,h as A,i as L,b as S,I as _,S as C,j as D,k,l as z,m as $,n as R}from"./index-DkqPCgzd.js";import"./vendor-zRGSVNlp.js";import"./tanstack-kLVQfJrB.js";import"./react-dom-sBYGDXCa.js";import"./radix-ui-ByoYm48K.js";import"./framer-motion-Csc3AcnG.js";import"./zod-BZDc1NAD.js";const q=e,P=s.forwardRef(({className:e,...s},i)=>a.jsx(t,{ref:i,className:f("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));P.displayName=t.displayName;const T=s.forwardRef(({className:e,...s},t)=>a.jsx(i,{ref:t,className:f("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));T.displayName=i.displayName;const B=s.forwardRef(({className:e,...s},t)=>a.jsx(l,{ref:t,className:f("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));B.displayName=l.displayName;const M={new:"bg-blue-500",contacted:"bg-yellow-500",qualified:"bg-green-500",proposal_sent:"bg-purple-500",won:"bg-emerald-500",lost:"bg-red-500"},V={low:"bg-gray-500",medium:"bg-orange-500",high:"bg-red-500",urgent:"bg-red-700"};function E(){const{isAuthenticated:e,isLoading:t}=function(){const{data:e,isLoading:s}=r({queryKey:["/api/auth/user"],retry:!1});return{user:e,isLoading:s,isAuthenticated:!!e}}(),{toast:i}=N(),[l,f]=s.useState({status:"",priority:"",source:"",search:""});c(),s.useEffect(()=>{if(!t&&!e)return i({title:"Unauthorized",description:"You need to sign in to access the CRM system.",variant:"destructive"}),void setTimeout(()=>{window.location.href="/api/login"},500)},[e,t,i]);const{data:E,error:I}=r({queryKey:["/api/crm/dashboard"],enabled:e}),{data:F,error:K}=r({queryKey:["/api/crm/leads",l],enabled:e});if(s.useEffect(()=>{I&&/^401: .*Unauthorized/.test(I.message)&&(i({title:"Session Expired",description:"Please sign in again to continue.",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500))},[I,i]),t)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})});if(!e)return a.jsx(v,{});const U=F?.data||[],W=E?.data||null,H=e=>{const s=e.replace(/\D/g,"");return 10===s.length?`(${s.slice(0,3)}) ${s.slice(3,6)}-${s.slice(6)}`:e},Q=e=>M[e]||"bg-gray-500";return a.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"CRM Dashboard"}),a.jsx("p",{className:"text-gray-600",children:"Manage your sales leads and track performance"})]}),a.jsxs(y,{variant:"outline",onClick:()=>{window.location.href="/api/logout"},children:[a.jsx(n,{className:"w-4 h-4 mr-2"}),"Logout"]})]}),a.jsxs(q,{defaultValue:"dashboard",className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs(P,{children:[a.jsx(T,{value:"dashboard",children:"Dashboard"}),a.jsx(T,{value:"leads",children:"Leads"}),a.jsx(T,{value:"activities",children:"Activities"})]}),a.jsx(g,{href:"/email-test",children:a.jsxs(y,{variant:"outline",size:"sm",children:[a.jsx(d,{className:"h-4 w-4 mr-2"}),"Email Test"]})})]}),a.jsx(B,{value:"dashboard",className:"space-y-6",children:W?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[a.jsxs(b,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(A,{className:"text-sm font-medium",children:"Total Leads"}),a.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsx(L,{children:a.jsx("div",{className:"text-2xl font-bold",children:W.totalLeads})})]}),a.jsxs(b,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(A,{className:"text-sm font-medium",children:"New Leads"}),a.jsx(o,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsx(L,{children:a.jsx("div",{className:"text-2xl font-bold",children:W.newLeads})})]}),a.jsxs(b,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(A,{className:"text-sm font-medium",children:"Won Deals"}),a.jsx(m,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsx(L,{children:a.jsx("div",{className:"text-2xl font-bold",children:W.wonLeads})})]}),a.jsxs(b,{children:[a.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(A,{className:"text-sm font-medium",children:"Proposals Sent"}),a.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),a.jsx(L,{children:a.jsx("div",{className:"text-2xl font-bold",children:W.proposalsSent})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs(b,{children:[a.jsx(w,{children:a.jsx(A,{children:"Leads by Source"})}),a.jsx(L,{children:a.jsx("div",{className:"space-y-2",children:W.leadsBySource.map(e=>a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"capitalize",children:e.source.replace("_"," ")}),a.jsx(S,{variant:"secondary",children:e.count})]},e.source))})})]}),a.jsxs(b,{children:[a.jsx(w,{children:a.jsx(A,{children:"Leads by Status"})}),a.jsx(L,{children:a.jsx("div",{className:"space-y-2",children:W.leadsByStatus.map(e=>a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:`w-3 h-3 rounded-full ${Q(e.status)}`}),a.jsx("span",{className:"capitalize",children:e.status.replace("_"," ")})]}),a.jsx(S,{variant:"secondary",children:e.count})]},e.status))})})]})]}),a.jsxs(b,{children:[a.jsx(w,{children:a.jsx(A,{children:"Recent Activities"})}),a.jsx(L,{children:a.jsx("div",{className:"space-y-4",children:W.recentActivities.slice(0,5).map(e=>a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex-shrink-0",children:["call"===e.type&&a.jsx(j,{className:"h-4 w-4 text-blue-500"}),"email"===e.type&&a.jsx(d,{className:"h-4 w-4 text-green-500"}),"note"===e.type&&a.jsx(u,{className:"h-4 w-4 text-gray-500"}),"meeting"===e.type&&a.jsx(p,{className:"h-4 w-4 text-purple-500"}),"status_change"===e.type&&a.jsx(h,{className:"h-4 w-4 text-orange-500"}),"treatment_quote"===e.type&&a.jsx(m,{className:"h-4 w-4 text-green-600"})]}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"font-medium text-sm truncate",children:e.subject}),a.jsxs("p",{className:"text-xs text-gray-500",children:["by ",e.performedBy," â€¢ ",e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"]})]})]},e.id))})})]})]}):a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-gray-500",children:"Loading dashboard data..."})})}),a.jsxs(B,{value:"leads",className:"space-y-6",children:[a.jsx(b,{children:a.jsx(L,{className:"pt-6",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsx(_,{placeholder:"Search leads...",value:l.search,onChange:e=>f({...l,search:e.target.value})}),a.jsxs(C,{value:l.status,onValueChange:e=>f({...l,status:e}),children:[a.jsx(D,{children:a.jsx(k,{placeholder:"Status"})}),a.jsxs(z,{children:[a.jsx($,{value:"",children:"All Statuses"}),a.jsx($,{value:"new",children:"New"}),a.jsx($,{value:"contacted",children:"Contacted"}),a.jsx($,{value:"qualified",children:"Qualified"}),a.jsx($,{value:"proposal_sent",children:"Proposal Sent"}),a.jsx($,{value:"won",children:"Won"}),a.jsx($,{value:"lost",children:"Lost"})]})]}),a.jsxs(C,{value:l.priority,onValueChange:e=>f({...l,priority:e}),children:[a.jsx(D,{children:a.jsx(k,{placeholder:"Priority"})}),a.jsxs(z,{children:[a.jsx($,{value:"",children:"All Priorities"}),a.jsx($,{value:"low",children:"Low"}),a.jsx($,{value:"medium",children:"Medium"}),a.jsx($,{value:"high",children:"High"}),a.jsx($,{value:"urgent",children:"Urgent"})]})]}),a.jsxs(C,{value:l.source,onValueChange:e=>f({...l,source:e}),children:[a.jsx(D,{children:a.jsx(k,{placeholder:"Source"})}),a.jsxs(z,{children:[a.jsx($,{value:"",children:"All Sources"}),a.jsx($,{value:"consultation_form",children:"Consultation Form"}),a.jsx($,{value:"contact_form",children:"Contact Form"}),a.jsx($,{value:"provider_application",children:"Provider Application"})]})]})]})})}),a.jsx("div",{className:"grid gap-4",children:U.map(e=>{return a.jsx(b,{className:"hover:shadow-md transition-shadow",children:a.jsx(L,{className:"pt-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("h3",{className:"font-semibold",children:e.fullName}),a.jsx(S,{className:`text-white ${Q(e.status)}`,children:e.status.replace("_"," ")}),a.jsx(S,{className:`text-white ${s=e.priority,V[s]||"bg-gray-500"}`,children:e.priority})]}),a.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(d,{className:"h-4 w-4"}),a.jsx("a",{href:`mailto:${e.email}`,className:"hover:text-blue-600",children:e.email})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(j,{className:"h-4 w-4"}),a.jsx("a",{href:`tel:${e.phone}`,className:"hover:text-blue-600",children:H(e.phone)})]}),e.treatmentInterest&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(h,{className:"h-4 w-4"}),a.jsxs("span",{children:["Interested in: ",e.treatmentInterest]})]})]}),e.notes&&a.jsx("p",{className:"mt-2 text-sm text-gray-700 bg-gray-50 p-2 rounded",children:e.notes})]}),a.jsxs("div",{className:"flex flex-col items-end gap-2",children:[a.jsx("span",{className:"text-xs text-gray-500 capitalize",children:e.source.replace("_"," ")}),a.jsx("span",{className:"text-xs text-gray-500",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"}),a.jsx(g,{href:`/crm/lead/${e.id}`,children:a.jsx(y,{size:"sm",children:"View Details"})})]})]})})},e.id);var s})})]}),a.jsx(B,{value:"activities",className:"space-y-6",children:a.jsxs(b,{children:[a.jsxs(w,{children:[a.jsx(A,{children:"Recent Activities"}),a.jsx(R,{children:"All recent lead activities and interactions"})]}),a.jsx(L,{children:a.jsx("div",{className:"space-y-4",children:(W?.recentActivities||[]).map(e=>a.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-lg",children:[a.jsxs("div",{className:"flex-shrink-0 mt-1",children:["call"===e.type&&a.jsx(j,{className:"h-5 w-5 text-blue-500"}),"email"===e.type&&a.jsx(d,{className:"h-5 w-5 text-green-500"}),"note"===e.type&&a.jsx(u,{className:"h-5 w-5 text-gray-500"}),"meeting"===e.type&&a.jsx(p,{className:"h-5 w-5 text-purple-500"}),"status_change"===e.type&&a.jsx(h,{className:"h-5 w-5 text-orange-500"}),"treatment_quote"===e.type&&a.jsx(m,{className:"h-5 w-5 text-green-600"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("h4",{className:"font-medium",children:e.subject}),a.jsx("span",{className:"text-sm text-gray-500",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"N/A"})]}),e.description&&a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[a.jsxs("span",{className:"capitalize",children:["Type: ",e.type.replace("_"," ")]}),a.jsxs("span",{children:["By: ",e.performedBy]})]})]})]},e.id))})})]})})]})]})})}export{E as default};
//# sourceMappingURL=crm-DNX2tHCs.js.map
